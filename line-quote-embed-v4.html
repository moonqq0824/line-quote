<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æ™¶å…¨è±ï½œç·šä¸Šè©¢åƒ¹ï¼ˆåµŒå…¥ç‰ˆ v4ï¼‰</title>
<style>
  :root{
    --brand-green:#4A7C2D;
    --brand-green-2:#7FB241;
    --text:#333;
    --muted:#777;
    --border:#ccc;
    --bg:#fff;
  }
  /* åµŒå…¥å‹å–„ï¼šå¤–è§€ç°¡æ½”ã€ç„¡å¤–æ¡†å¡ç‰‡ */
  .embed-wrap{
    max-width: 900px;
    margin: 0 auto;
    padding: 0 8px;
    font-family: 'Microsoft JhengHei','Noto Sans TC',system-ui,-apple-system,Arial,sans-serif;
    color: var(--text);
  }
  .embed-title{
    text-align:center;
    color: var(--brand-green);
    font-size: 22px;
    margin: 0 0 10px 0;
  }
  .embed-sub{
    text-align:center;
    color:#666;
    font-size:14px;
    margin: 0 0 18px 0;
  }
  .grid{
    display:flex;
    flex-wrap:wrap;
    gap: 16px;
  }
  .col{
    flex:1 1 360px;
    position:relative;
  }
  input,select,textarea{
    width:100%;
    padding:12px;
    font-size:15px;
    border:1px solid var(--border);
    border-radius:8px;
    box-sizing:border-box;
    background:#fff;
  }
  input,textarea{ spellcheck: false; }
  textarea{ min-height:100px; resize:vertical; }
  /* æµ®å‹•æ¨™ç±¤ */
  .col label{
    position:absolute;
    left:10px; top:10px; padding:0 6px; background:#fff;
    color:var(--muted); font-size:14px; pointer-events:none; transition:all .18s ease;
  }
  .col input:focus + label,
  .col input:not(:placeholder-shown) + label,
  .col select:focus + label,
  .col select:not([value=""]) + label,
  .col textarea:focus + label,
  .col textarea:not(:placeholder-shown) + label{
    top: -9px; left: 8px; font-size: 12px; color: var(--brand-green);
  }
  .help{ font-size:12px; color:#888; margin:6px 0 0 2px; }
  .tip{
    margin-top:10px; font-size:13px; color:#555; background:#f6f7f8; border:1px dashed #cfd4d8;
    padding:10px 12px; border-radius:8px;
  }
  .req{ color:#d22; margin-left:4px; }
  .actions{
    display:flex; flex-wrap:wrap; gap: 10px; margin-top:16px;
  }
  .btn{
    appearance:none; border:0; border-radius:10px;
    padding:12px 16px; font-size:16px; font-weight:700;
    cursor:pointer; transition:transform .05s ease; flex:1 1 220px;
  }
  .btn:active{ transform: translateY(1px); }
  .btn-primary{
    background: linear-gradient(135deg, var(--brand-green), var(--brand-green-2));
    color:#fff;
  }
  .btn-secondary{
    background:#00c300; color:#fff; text-decoration:none; text-align:center;
    line-height:22px; display:inline-block; border-radius:10px; font-weight:700;
  }
  .msg{ display:none; margin-top:10px; color:var(--brand-green); font-weight:700; text-align:center; }

  /* é è¦½æµ®å±¤ */
  .modal{
    position: fixed; inset: 0;
    background: rgba(0,0,0,.45);
    display:none; align-items: center; justify-content: center; padding: 16px;
    z-index: 9999;
  }
  .panel{
    background: var(--bg);
    border-radius: 12px;
    max-width: 720px; width: 100%;
    box-shadow: 0 16px 40px rgba(0,0,0,.15);
    overflow:hidden;
  }
  .panel-head{
    padding: 14px 18px;
    background: #f2f6f0;
    color: var(--brand-green);
    font-weight: 700;
    display:flex; align-items:center; justify-content:space-between;
  }
  .panel-body{ padding: 16px 18px; }
  .preview-box{
    white-space: pre-wrap;
    background:#fff; border:1px solid #e2e6ea; border-radius:8px;
    padding:12px; font-size:14px; min-height:140px;
  }
  .panel-actions{
    display:flex; flex-wrap:wrap; gap:10px;
    padding: 14px 18px 18px;
  }
  .btn-ghost{
    background:#fff; border:1px solid #cfd4d8; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer;
  }
  .close-x{
    background:transparent; border:0; font-size:20px; color:#5a6; cursor:pointer; line-height:1;
  }
  @media (max-width:560px){
    .embed-title{ font-size:20px; }
  }
</style>
</head>
<body>
<div class="embed-wrap" role="form" aria-label="æ™¶å…¨è± ç·šä¸Šè©¢åƒ¹ï¼ˆåµŒå…¥ç‰ˆ v4ï¼‰">
  <h2 class="embed-title">æ™¶å…¨è±æœ‰é™å…¬å¸ ç·šä¸Šè©¢åƒ¹</h2>
  <p class="embed-sub">å…ˆåœ¨ä¸‹æ–¹å¡«å¯«ï¼ŒæŒ‰ã€Œä¸‹ä¸€æ­¥ï¼šé è¦½ã€å¾Œç¢ºèªå…§å®¹ï¼Œå†ç”¨ LINE å‚³é€å³å¯ã€‚</p>

  <div class="grid">
    <div class="col">
      <input id="company" placeholder=" " autocomplete="organization" required>
      <label for="company">å…¬å¸åç¨±ï¼ˆä¾‹ï¼šOOOOæœ‰é™å…¬å¸ï¼‰<span class="req">*</span></label>
    </div>
    <div class="col">
      <input id="contact" placeholder=" " autocomplete="name" required>
      <label for="contact">è¯çµ¡äºº<span class="req">*</span></label>
    </div>

    <div class="col">
      <input id="email" type="email" placeholder=" " inputmode="email" autocomplete="email" required>
      <label for="email">Email<span class="req">*</span></label>
      <div class="help">è«‹å¡«å¸¸ç”¨ä¿¡ç®±ï¼Œä¾¿æ–¼å¯„é€æ­£å¼å ±åƒ¹å–®</div>
    </div>
    <div class="col">
      <input id="phone" type="tel" placeholder=" " inputmode="numeric" autocomplete="tel">
      <label for="phone">æ‰‹æ©Ÿï¼ˆè¼¸å…¥æ™‚è‡ªå‹•åŠ  - ï¼‰</label>
      <div class="help">æ ¼å¼ï¼š0912-345-678</div>
    </div>

    <div class="col">
      <input id="companyPhone" type="tel" placeholder=" " autocomplete="tel">
      <label for="companyPhone">å…¬å¸é›»è©±ï¼ˆå¯å«åˆ†æ©Ÿï¼‰</label>
      <div class="help">ä¾‹ï¼š02-1234-5678#123 æˆ– 07-123-4567 åˆ†æ©Ÿ 123</div>
    </div>
    <div class="col">
      <select id="process" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="é›»è§£">é›»è§£</option>
        <optgroup label="é›»è‘—ï¼ˆæ³³ï¼‰">
          <option value="é›»è‘—ï¼ˆæ³³ï¼‰-å¹³é»‘">å¹³é»‘</option>
          <option value="é›»è‘—ï¼ˆæ³³ï¼‰-æ¶ˆå…‰é»‘">æ¶ˆå…‰é»‘</option>
          <option value="é›»è‘—ï¼ˆæ³³ï¼‰-å…¶ä»–ç‰¹æ®Šè‰²">å…¶ä»–ç‰¹æ®Šè‰²</option>
        </optgroup>
        <option value="é›»æ¼¿">é›»æ¼¿</option>
      </select>
      <label for="process">éœ€æ±‚å·¥è—<span class="req">*</span></label>
    </div>

    <div class="col">
      <input id="qty" type="number" placeholder=" " inputmode="numeric" min="1" step="1">
      <label for="qty">é è¨ˆè£½é€ æ•¸é‡</label>
    </div>
    <div class="col">
      <input id="material" placeholder=" " autocomplete="off">
      <label for="material">æè³ªï¼ˆä¾‹ï¼šSUS304 / é‹åˆé‡‘ï¼‰</label>
    </div>
    <div class="col">
      <input id="surface" placeholder=" " autocomplete="off">
      <label for="surface">å·¥è—éœ€æ±‚ï¼ˆä¾‹ï¼šå…‰æ»‘ / å»ç„Šç–¤ / æ¶ˆå…‰é»‘ï¼‰</label>
    </div>

    <div class="col" style="flex:1 1 100%;">
      <textarea id="note" placeholder=" "></textarea>
      <label for="note">å‚™è¨»</label>
    </div>
  </div>

  <div class="tip">ğŸ“ å°æé†’ï¼šç‚ºåŠ é€Ÿå ±åƒ¹ï¼Œè«‹åœ¨ LINE ä¸€ä½µå‚³é€ <strong>3D åœ–æª”ï¼ˆSolidWorks/STEPï¼‰æˆ–ç”¢å“ç…§ç‰‡</strong>ã€‚</div>

  <div class="actions">
    <button class="btn btn-primary" id="previewBtn" type="button">ä¸‹ä¸€æ­¥ï¼šé è¦½</button>
    <a class="btn btn-secondary" id="openLineDirect" href="https://lin.ee/uYm6MpA" target="_blank" rel="noopener">å…ˆé–‹ LINEï¼ˆç©ºç™½ï¼‰</a>
  </div>
  <div class="msg" id="copiedMsg">å·²è¤‡è£½ï¼Œè«‹åœ¨ LINE å°è©±è¦–çª—è²¼ä¸Šä¸¦å‚³é€ã€‚</div>
</div>

<!-- é è¦½æµ®å±¤ -->
<div class="modal" id="previewModal" aria-hidden="true">
  <div class="panel" role="dialog" aria-labelledby="previewTitle">
    <div class="panel-head">
      <div id="previewTitle">é è¦½å°‡å‚³é€çš„å…§å®¹</div>
      <button class="close-x" id="closePreview" aria-label="é—œé–‰">Ã—</button>
    </div>
    <div class="panel-body">
      <div class="preview-box" id="previewBox"></div>
      <div class="tip" style="margin-top:12px;">å®Œæˆå¾Œè«‹åˆ° LINE å°è©±ä¸­ã€Œè²¼ä¸Šã€ä¸¦å‚³é€ï¼›è‹¥æ–¹ä¾¿ï¼Œè«‹ä¸€ä½µé™„ä¸Šåœ–æª”ï¼Œæˆ‘å€‘èƒ½æ›´å¿«å ±åƒ¹ã€‚</div>
    </div>
    <div class="panel-actions">
      <button class="btn-ghost" id="backEdit" type="button">è¿”å›ä¿®æ”¹</button>
      <button class="btn btn-primary" id="confirmCopy" type="button">ç¢ºèªè¤‡è£½</button>
      <button class="btn btn-secondary" id="sendLineDirect" type="button">ç›´æ¥ç”¨ LINE ç™¼é€</button>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const company = $('company'), contact = $('contact'), email = $('email');
  const phone = $('phone'), companyPhone = $('companyPhone');
  const process = $('process'), qty = $('qty');
  const material = $('material'), surface = $('surface'), note = $('note');
  const previewBtn = $('previewBtn'), copiedMsg = $('copiedMsg');
  const modal = $('previewModal'), previewBox = $('previewBox'), closePreview = $('closePreview'), backEdit=$('backEdit');
  const confirmCopy = $('confirmCopy'), sendLineDirect = $('sendLineDirect'), openLineDirect = $('openLineDirect');

  // æ‰‹æ©Ÿè™Ÿç¢¼è‡ªå‹•æ ¼å¼åŒ–ï¼š0912-345-678ï¼ˆ4-3-3ï¼‰
  function formatTWMobile(raw){
    const digits = raw.replace(/\D/g, '').slice(0,10);
    const a = digits.slice(0,4), b = digits.slice(4,7), c = digits.slice(7,10);
    let out = a; if(b) out += '-' + b; if(c) out += '-' + c; return out;
  }
  phone.addEventListener('input', ()=>{
    const start = phone.selectionStart, beforeLen = phone.value.length;
    phone.value = formatTWMobile(phone.value);
    const afterLen = phone.value.length, offset = afterLen - beforeLen;
    try{ phone.setSelectionRange(Math.max(0, start + offset), Math.max(0, start + offset)); }catch(e){}
  });

  function validate(){
    if(!company.value.trim() || !contact.value.trim() || !email.value.trim() || !process.value){
      alert('è«‹å¡«å¯«æ‰€æœ‰æ¨™ç¤º * çš„å¿…å¡«æ¬„ä½ã€‚'); return false;
    }
    // è‡³å°‘å¡«ä¸€å€‹é›»è©±
    const mobileDigits = phone.value.replace(/\D/g,'');
    const hasMobile = mobileDigits.length === 10;
    const hasCompanyPhone = companyPhone.value.trim().length > 0;
    if(!hasMobile && !hasCompanyPhone){
      alert('è«‹è‡³å°‘å¡«å¯«ã€Œæ‰‹æ©Ÿã€æˆ–ã€Œå…¬å¸é›»è©±ã€ã€‚'); return false;
    }
    // email basic
    const emailPattern=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
    if(!emailPattern.test(email.value.trim())){ alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Emailã€‚'); return false; }
    // è‹¥å¡«äº†æ‰‹æ©Ÿï¼Œéœ€ç‚º 10 ç¢¼
    if(phone.value.trim() && !hasMobile){ alert('æ‰‹æ©Ÿè«‹è¼¸å…¥ 10 ä½æ•¸ï¼ˆä¾‹å¦‚ 0912-345-678ï¼‰ã€‚'); return false; }
    return true;
  }

  function buildText(){
    const lines = [
      'æ™¶å…¨è±è©¢åƒ¹éœ€æ±‚',
      'å…¬å¸åç¨±ï¼š' + company.value.trim(),
      'è¯çµ¡äººï¼š' + contact.value.trim(),
      'Emailï¼š' + email.value.trim(),
      (phone.value.trim() ? ('æ‰‹æ©Ÿï¼š' + phone.value.trim()) : ''),
      (companyPhone.value.trim() ? ('å…¬å¸é›»è©±ï¼š' + companyPhone.value.trim()) : ''),
      'éœ€æ±‚å·¥è—ï¼š' + (process.value || ''),
      'é è¨ˆè£½é€ æ•¸é‡ï¼š' + (qty.value.trim() || ''),
      'æè³ªï¼š' + (material.value.trim() || ''),
      'å·¥è—éœ€æ±‚ï¼š' + (surface.value.trim() || ''),
      'å‚™è¨»ï¼š' + (note.value.trim() || ''),
      'ï¼ˆè«‹æ–¼ LINE ä¸€ä½µå‚³é€ 3D åœ–æª”æˆ–ç”¢å“ç…§ç‰‡ï¼ŒåŠ é€Ÿå ±åƒ¹ï¼‰'
    ].filter(Boolean);
    return lines.join('\n');
  }

  function showModal(text){
    previewBox.textContent = text;
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
  }
  function hideModal(){
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
  }

  function copyNative(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    }
    return Promise.reject(new Error('clipboard-api-unavailable'));
  }
  function copyFallback(text){
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta); ta.select();
    let ok=false; try{ ok = document.execCommand('copy'); }catch(e){ ok=false; }
    document.body.removeChild(ta);
    return ok?Promise.resolve():Promise.reject(new Error('execCommand-failed'));
  }
  function copyText(text){
    return copyNative(text).catch(()=>copyFallback(text));
  }

  function openLineWithText(text){
    const url = 'https://line.me/R/msg/text/?' + encodeURIComponent(text);
    window.open(url, '_blank', 'noopener');
  }

  previewBtn.addEventListener('click', ()=>{
    if(!validate()) return;
    const text = buildText();
    showModal(text);
  });
  closePreview.addEventListener('click', hideModal);
  backEdit.addEventListener('click', hideModal);

  confirmCopy.addEventListener('click', ()=>{
    const text = previewBox.textContent;
    copyText(text).then(()=>{
      copiedMsg.style.display='block';
      confirmCopy.textContent='å·²è¤‡è£½';
      setTimeout(()=>{ confirmCopy.textContent='ç¢ºèªè¤‡è£½'; }, 1200);
    }).catch(()=>{
      alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–é è¦½æ–‡å­—å¾Œè¤‡è£½ã€‚');
    });
  });

  sendLineDirect.addEventListener('click', ()=>{
    const text = previewBox.textContent;
    // å˜—è©¦å…ˆè¤‡è£½ï¼Œè‹¥å¤±æ•—ä»ç„¶é–‹ LINE
    copyText(text).finally(()=>{
      openLineWithText(text);
    });
  });

  // å…è¨±ç›´æ¥å¾ä¸»ç•«é¢é–‹ LINEï¼ˆç©ºç™½ï¼Œä¸å¸¶æ–‡å­—ï¼‰
  openLineDirect.addEventListener('click', (e)=>{
    // default è¡Œç‚ºå³å¯
  });

  // Esc é—œé–‰
  document.addEventListener('keydown', (ev)=>{
    if(ev.key === 'Escape') hideModal();
  });
})();
</script>
</body>
</html>
